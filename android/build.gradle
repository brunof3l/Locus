// Arquivo: android/build.gradle
// Configuração compatível com Gradle 8.7 + Expo SDK 51+

buildscript {
    ext {
        buildToolsVersion = findProperty('android.buildToolsVersion') ?: '34.0.0'
        minSdkVersion = Integer.parseInt(findProperty('android.minSdkVersion') ?: '23')
        compileSdkVersion = Integer.parseInt(findProperty('android.compileSdkVersion') ?: '34')
        targetSdkVersion = Integer.parseInt(findProperty('android.targetSdkVersion') ?: '34')
        kotlinVersion = findProperty('android.kotlinVersion') ?: '1.9.24'
        ndkVersion = "26.1.10909125"
    }

    repositories {
        // Repositórios oficiais
        google()
        mavenCentral()
        gradlePluginPortal()

        // Importante: apontar para os pacotes locais do Expo dentro do node_modules
        maven { url "$rootDir/../node_modules/expo/android/maven" }
        maven { url "$rootDir/../node_modules/expo-modules-core/android/maven" }
    }

    dependencies {
        classpath("com.android.tools.build:gradle:8.2.2")
        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:1.9.24")
        classpath("com.facebook.react:react-native-gradle-plugin")

        // ⚠️ NÃO especifique a versão aqui!
        // O Gradle precisa carregar o plugin direto do node_modules.
        classpath("expo.modules:expo-module-gradle-plugin")
    }
}

apply plugin: "com.facebook.react.rootproject"

allprojects {
    repositories {
        // Pacotes do React Native e JSC instalados via npm
        maven {
            url(new File(
                ['node', '--print', "require.resolve('react-native/package.json')"]
                    .execute(null, rootDir)
                    .text
                    .trim(),
                '../android'
            ))
        }

        maven {
            url(new File(
                ['node', '--print', "require.resolve('jsc-android/package.json', { paths: [require.resolve('react-native/package.json')] })"]
                    .execute(null, rootDir)
                    .text
                    .trim(),
                '../dist'
            ))
        }

        // Repositórios padrão
        google()
        mavenCentral()
        maven { url 'https://www.jitpack.io' }

        // ⚙️ Expo local (necessário!)
        maven { url "$rootDir/../node_modules/expo/android/maven" }
        maven { url "$rootDir/../node_modules/expo-modules-core/android/maven" }
    }
}
